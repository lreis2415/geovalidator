@prefix arcgis: <http://www.egc.org/ont/process/arcgis#> .
@prefix data: <http://www.egc.org/ont/data#> .
@prefix geo: <http://www.opengis.net/ont/geosparql#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sf: <http://www.opengis.net/ont/sf#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

arcgis:clip_features a arcgis:ArcGISInput,
        sh:NodeShape ;
    sh:description "Parameter clip_features: the features to clip input features in ArcGIS Clip analysis"@en ;
    sh:node data:VectorDataShape ;
    sh:sparql [ sh:message "Clip features cannot be used to clip input features. When the Input Features are polygons, the Clip Features must also be polygons. When the Input Features are lines, the Clip Features can be lines or polygons. When the Input Features are points, the Clip Features can be points, lines, or polygons."@en ;
            sh:prefixes [ a sh:PrefixDeclaration ;
                    sh:declare [ sh:namespace "http://www.opengis.net/ont/geosparql#"^^xsd:anyURI ;
                            sh:prefix "geo" ],
                        [ sh:namespace "http://www.egc.org/ont/data#"^^xsd:anyURI ;
                            sh:prefix "data" ],
                        [ sh:namespace "http://www.opengis.net/ont/sf#"^^xsd:anyURI ;
                            sh:prefix "sf" ] ] ;
            sh:select """
SELECT $this (geo:hasGeometry AS ?path) (?clip_geom AS ?value)
	WHERE {
		$this geo:hasGeometry ?clip_geom.
        data:in_features_data geo:hasGeometry ?in_geom.
		FILTER ( 
			IF(EXISTS {?in_geom a sf:Point},false,true)||
            IF(EXISTS {?in_geom a sf:Line} && NOT EXISTS {?clip_geom a sf:Point},false,true)||
            IF(EXISTS {?in_geom a sf:Polygon} && EXISTS {?clip_geom a sf:Polygon},false,true)). 
        }
""" ] ;
    sh:targetNode data:clip_features_data .

